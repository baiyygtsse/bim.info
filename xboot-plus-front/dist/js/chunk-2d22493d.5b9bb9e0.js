(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22493d"],{e172:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[e.showOnly?e._e():t("Row",{staticClass:"operation"},[t("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:e.add}},[e._v("添加文件夹")]),t("Dropdown",{on:{"on-click":e.handleTreeDropdown}},[t("Button",[e._v(" 更多操作 "),t("Icon",{attrs:{type:"md-arrow-dropdown"}})],1),t("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t("DropdownItem",{attrs:{name:"edit",disabled:0==e.selectNode.id||-1==e.selectNode.id}},[e._v("编辑文件夹")]),t("DropdownItem",{attrs:{name:"del",disabled:0==e.selectNode.id||-1==e.selectNode.id}},[e._v("删除文件夹")]),t("DropdownItem",{attrs:{name:"refresh"}},[e._v("刷新")])],1)],1)],1),e.showOnly?e._e():t("Alert",{attrs:{"show-icon":""}},[e._v(" 当前选择： "),t("span",{staticClass:"select-title"},[e._v(e._s(e.editTitle))]),e.editTitle&&"0"!=e.selectNode.id?t("a",{staticClass:"select-clear",on:{click:e.cancelEdit}},[e._v("取消选择")]):e._e()]),t("Input",{attrs:{suffix:"ios-search",placeholder:"输入搜索文件夹名称",clearable:""},on:{"on-change":e.search},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}}),t("div",{staticStyle:{position:"relative"}},[t("div",{staticClass:"tree-bar",style:{maxHeight:e.maxHeight}},[t("Tree",{ref:"tree",attrs:{data:e.data,"load-data":e.loadData,render:e.renderContent},on:{"on-check-change":e.changeSelect,"on-select-change":e.selectTree}})],1),e.loading?t("Spin",{attrs:{size:"large",fix:""}}):e._e()],1),t("Modal",{attrs:{title:e.modalTitle,"mask-closable":!1,width:500},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[t("Form",{ref:"form",attrs:{model:e.form,"label-width":85,rules:e.formValidate}},[t("FormItem",{attrs:{label:"上级节点："}},[e._v(e._s(e.form.parentTitle)+" "),t("Tooltip",{staticStyle:{display:"inline-block !important"},attrs:{content:"0"==e.selectNode.id?"若需添加子目录，请先点击选择一个文件夹":"若需添加一级目录，请先取消选择当前文目录",placement:"right",transfer:"","max-width":"290"}},[t("Icon",{staticStyle:{"margin-left":"10px",cursor:"pointer"},attrs:{type:"md-help-circle",size:"20",color:"#c5c5c5"}})],1)],1),t("FormItem",{attrs:{label:"文件夹名",prop:"title"}},[t("Input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("FormItem",{attrs:{label:"排序值",prop:"sortOrder"}},[t("Tooltip",{attrs:{trigger:"hover",placement:"right",content:"值越小越靠前，支持小数"}},[t("InputNumber",{attrs:{max:1e3,min:0},model:{value:e.form.sortOrder,callback:function(t){e.$set(e.form,"sortOrder",t)},expression:"form.sortOrder"}})],1)],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"text"},on:{click:function(t){e.modalVisible=!1}}},[e._v("取消")]),t("Button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handelSubmit}},[e._v("提交")])],1)],1)],1)},l=[],a=i("365c"),o={name:"fileCategory",props:{showOnly:{type:Boolean,default:!1}},data(){return{loading:!1,maxHeight:"500px",searchKey:"",selectNode:{},selectList:[],modalVisible:!1,modalTitle:"",editTitle:"",submitLoading:!1,form:{title:"",sortOrder:0,parentId:0},formValidate:{title:[{required:!0,message:"不能为空",trigger:"blur"}],sortOrder:[{required:!0,type:"number",message:"排序值不能为空",trigger:"change"}]},data:[],editData:{}}},methods:{init(){this.getParentList(),this.editTitle="未归档",this.selectNode={id:"0",title:"未归档"},this.$emit("on-select",this.selectNode)},renderContent(e,{root:t,node:i,data:s}){let l="md-folder-open";return"0"==s.id?l="md-pricetags":"-1"==s.id&&(l="md-star-outline"),e("span",[e("span",[e("Icon",{props:{type:l,size:16},style:{"margin-right":"8px"}}),e("span",s.title)])])},getParentList(){this.loading=!0;let e={parentId:0,delFlag:0};Object(a["Db"])(e).then(e=>{this.loading=!1,e.success&&(e.result.forEach((function(e){e.isParent&&(e.loading=!1,e.children=[],e._loading=!1)})),this.data=e.result,this.data.unshift({id:"0",title:"未归档",selected:!0},{id:"-1",title:"收藏夹",selected:!1}))})},loadData(e,t){let i={parentId:e.id,delFlag:0};Object(a["Db"])(i).then(e=>{e.success&&(e.result.forEach((function(e){e.isParent&&(e.loading=!1,e.children=[],e._loading=!1)})),t(e.result))})},search(){this.searchKey?(this.loading=!0,Object(a["Dc"])({title:this.searchKey}).then(e=>{this.loading=!1,e.success&&(this.data=e.result)})):this.getParentList()},selectTree(e){if(e.length>0){this.$refs.form.resetFields();for(let s in e[0])null==e[0][s]&&(e[0][s]="");let t=JSON.stringify(e[0]),i=JSON.parse(t);this.selectNode=i,this.form=i,this.editData=i,this.editTitle=i.title,this.$emit("on-select",this.selectNode)}else this.cancelEdit()},cancelEdit(){if("0"==this.selectNode.id)return void(this.data[0].selected=!0);let e=this.$refs.tree.getSelectedNodes()[0];e&&(e.selected=!1),this.$refs.form.resetFields(),this.editData={},this.selectNode={id:"0",title:"未归档"},this.editTitle="未归档",this.data[0].selected=!0,this.$emit("on-select",this.selectNode)},changeSelect(e){this.selectList=e},handleTreeDropdown(e){"edit"==e?this.edit():"del"==e?this.del():"refresh"==e&&this.init()},add(){this.modalType=0,"0"==this.selectNode.id||"-1"==this.selectNode.id?(this.modalTitle="添加一级文件夹",this.form={parentId:"0",parentTitle:"一级目录",sortOrder:this.data.length+1}):(this.modalTitle="添加子文件夹",this.form.children||(this.form.children=[]),this.form={parentId:this.selectNode.id,parentTitle:this.selectNode.title,sortOrder:this.form.children.length+1}),this.modalVisible=!0},edit(){"0"!=this.selectNode.id&&"-1"!=this.selectNode.id?(this.editData&&(this.form=this.editData),this.modalType=1,this.modalTitle="编辑文件夹",this.modalVisible=!0):this.$Message.warning("您还未选择要编辑的文件夹")},handelSubmit(){this.$refs.form.validate(e=>{e&&(this.submitLoading=!0,0==this.modalType?(delete this.form.id,Object(a["d"])(this.form).then(e=>{this.submitLoading=!1,e.success&&(this.$Message.success("操作成功"),this.getParentList(),this.modalVisible=!1)})):1==this.modalType&&Object(a["ab"])(this.form).then(e=>{this.submitLoading=!1,e.success&&(this.editTitle=this.form.title,this.$Message.success("操作成功"),this.getParentList(),this.modalVisible=!1)}))})},del(){"0"!=this.selectNode.id&&"-1"!=this.selectNode.id?this.$Modal.confirm({title:"确认删除",loading:!0,content:"您确认要将文件夹 "+this.selectNode.title+" 及其所有文件移入回收站， 7天内后自动彻底删除",onOk:()=>{Object(a["Qc"])({id:this.selectNode.id}).then(e=>{this.$Modal.remove(),e.success&&(this.$Message.success("操作成功"),this.init())})}}):this.$Message.warning("您还未选择要删除的文件夹")}},mounted(){let e=document.documentElement.clientHeight;this.maxHeight=Number(e-287)+"px",this.init()}},r=o,d=i("2877"),n=Object(d["a"])(r,s,l,!1,null,null,null);t["default"]=n.exports}}]);