(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d3f7100","chunk-2d22493d"],{"0808":function(e,t,s){},"565b":function(e,t,s){e.exports=s.p+"img/play.a4e927cf.png"},"5d5a":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"search"},[e.showTrash?t("trash",{on:{close:function(t){e.showTrash=!1}}}):e._e(),t("Card",{directives:[{name:"show",rawName:"v-show",value:!e.showTrash,expression:"!showTrash"}]},[t("Row",{attrs:{type:"flex",justify:"space-between"}},[t("Col",{directives:[{name:"show",rawName:"v-show",value:e.expand,expression:"expand"}],attrs:{span:"5"}},[t("fileCategory",{on:{"on-select":e.selectCategory}})],1),t("div",{staticClass:"expand"},[t("Icon",{staticClass:"icon",attrs:{type:e.expandIcon,size:"16"},on:{click:e.changeExpand}})],1),t("Col",{attrs:{span:e.span}},[t("Row",{directives:[{name:"show",rawName:"v-show",value:e.openSearch,expression:"openSearch"}],nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}}},[t("Form",{ref:"searchForm",attrs:{model:e.searchForm,inline:"","label-width":70}},[t("FormItem",{attrs:{label:"文件名",prop:"title"}},[t("Input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:"请输入文件名",clearable:""},model:{value:e.searchForm.title,callback:function(t){e.$set(e.searchForm,"title",t)},expression:"searchForm.title"}})],1),t("FormItem",{attrs:{label:"创建时间"}},[t("DatePicker",{staticStyle:{width:"200px"},attrs:{options:e.options,type:"daterange",format:"yyyy-MM-dd",clearable:"",placeholder:"选择起始时间"},on:{"on-change":e.selectDateRange},model:{value:e.selectDate,callback:function(t){e.selectDate=t},expression:"selectDate"}})],1),t("FormItem",{staticClass:"br",staticStyle:{"margin-left":"-35px"}},[t("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:e.handleSearch}},[e._v("搜索")]),t("Button",{on:{click:e.handleReset}},[e._v("重置")])],1)],1)],1),t("Row",{staticClass:"operation",attrs:{align:"middle",justify:"space-between"}},[t("div",{staticClass:"br"},[t("Button",{attrs:{disabled:!e.searchForm.categoryId,type:"primary",icon:"md-cloud-upload"},on:{click:function(t){e.uploadVisible=!0}}},[e._v("上传文件")]),t("Dropdown",{on:{"on-click":e.handleDropdown}},[t("Button",[e._v(" 更多操作 "),t("Icon",{attrs:{type:"md-arrow-dropdown"}})],1),t("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t("DropdownItem",{directives:[{name:"show",rawName:"v-show",value:"list"==e.showType,expression:"showType == 'list'"}],attrs:{name:"moveAll"}},[e._v("移动")]),t("DropdownItem",{directives:[{name:"show",rawName:"v-show",value:"list"==e.showType,expression:"showType == 'list'"}],attrs:{name:"removeAll"}},[e._v("批量删除")]),t("DropdownItem",{directives:[{name:"show",rawName:"v-show",value:"thumb"==e.showType,expression:"showType == 'thumb'"}],attrs:{name:"title"}},[e._v("原名称排序")]),t("DropdownItem",{directives:[{name:"show",rawName:"v-show",value:"thumb"==e.showType,expression:"showType == 'thumb'"}],attrs:{name:"size"}},[e._v("文件大小排序")]),t("DropdownItem",{directives:[{name:"show",rawName:"v-show",value:"thumb"==e.showType,expression:"showType == 'thumb'"}],attrs:{name:"type"}},[e._v("文件类型排序")]),t("DropdownItem",{directives:[{name:"show",rawName:"v-show",value:"thumb"==e.showType,expression:"showType == 'thumb'"}],attrs:{name:"time"}},[e._v("创建时间排序")])],1)],1),t("Button",{attrs:{type:"dashed",icon:"md-trash"},on:{click:function(t){e.showTrash=!0}}},[e._v("回收站")])],1),t("div",{staticClass:"icons"},[t("Tooltip",{attrs:{content:"刷新",placement:"top",transfer:""}},[t("Icon",{staticClass:"item",attrs:{type:"md-refresh",size:"18"},on:{click:e.getDataList}})],1),t("Tooltip",{attrs:{content:e.openSearch?"关闭搜索":"开启搜索",placement:"top",transfer:""}},[t("Icon",{staticClass:"item tip",attrs:{type:"ios-search",size:"18"},on:{click:function(t){e.openSearch=!e.openSearch}}})],1),t("Tooltip",{attrs:{content:e.openTip?"关闭提示":"开启提示",placement:"top",transfer:""}},[t("Icon",{staticClass:"item tip",attrs:{type:"md-bulb",size:"18"},on:{click:function(t){e.openTip=!e.openTip}}})],1),t("Select",{staticStyle:{width:"150px",margin:"0 25px 0 15px"},on:{"on-change":e.changeFileType},model:{value:e.fileType,callback:function(t){e.fileType=t},expression:"fileType"}},[t("Option",{attrs:{value:"all"}},[e._v("所有文件")]),t("Option",{attrs:{value:"word"}},[e._v("Word")]),t("Option",{attrs:{value:"excel"}},[e._v("Excel")]),t("Option",{attrs:{value:"pdf"}},[e._v("PDF")]),t("Option",{attrs:{value:"pic"}},[e._v("图片")]),t("Option",{attrs:{value:"video"}},[e._v("视频")]),t("Option",{attrs:{value:"audio"}},[e._v("音频")]),t("Option",{attrs:{value:"text"}},[e._v("文本")]),t("Option",{attrs:{value:"ppt"}},[e._v("PPT")]),t("Option",{attrs:{value:"zip"}},[e._v("ZIP")]),t("Option",{attrs:{value:"rar"}},[e._v("RAR")])],1),t("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.changeShowType},model:{value:e.showType,callback:function(t){e.showType=t},expression:"showType"}},[t("Radio",{attrs:{title:"列表",label:"list"}},[t("Icon",{attrs:{type:"md-list"}})],1),t("Radio",{attrs:{title:"缩略图",label:"thumb"}},[t("Icon",{attrs:{type:"ios-apps"}})],1)],1)],1)]),t("div",{directives:[{name:"show",rawName:"v-show",value:"list"==e.showType,expression:"showType == 'list'"}]},[t("Alert",{directives:[{name:"show",rawName:"v-show",value:e.openTip,expression:"openTip"}],attrs:{"show-icon":""}},[e._v(" 已选择 "),t("span",{staticClass:"select-count"},[e._v(e._s(e.selectList.length))]),e._v(" 项 "),t("a",{staticClass:"select-clear",on:{click:e.clearSelectAll}},[e._v("清空")]),e.selectList.length>0?t("span",{staticStyle:{"margin-left":"15px"}},[e._v("共计 "+e._s(e.totalSize)+" 存储量")]):e._e()]),t("Table",{ref:"table",attrs:{loading:e.loading,border:"",columns:e.columns,data:e.data,sortable:"custom"},on:{"on-sort-change":e.changeSort,"on-selection-change":e.changeSelect}})],1),t("Row",{directives:[{name:"show",rawName:"v-show",value:"thumb"==e.showType,expression:"showType == 'thumb'"}],attrs:{type:"flex",gutter:30}},e._l(e.data,(function(i,a){return t("Col",{key:a,attrs:{lg:6,md:12,xs:12}},[t("Card",{staticClass:"oss-card"},[t("div",{staticClass:"content"},[i.isCollect?t("div",{staticClass:"collect-icon"},[t("Icon",{attrs:{type:"md-star",color:"#ffc60a",size:"18"}})],1):e._e(),i.type.indexOf("image")>=0?t("img",{staticClass:"img",attrs:{src:i.url},on:{click:function(t){return e.showPic(i)}}}):i.type.indexOf("video")>=0?t("div",{staticClass:"video",on:{click:function(t){return e.showVideo(i)}}},[t("video",{staticClass:"cover"},[t("source",{attrs:{src:i.url+"#t=1",preload:"metadata"}})]),t("img",{staticClass:"play",attrs:{src:s("565b")}})]):t("div",{staticClass:"other",on:{click:function(t){return e.previewFile(i)}}},[t("div",{staticClass:"name"},[e._v(e._s(i.title))]),t("div",{staticClass:"key"},[e._v(e._s(i.fkey))]),t("div",{staticClass:"info"},[e._v(" 文件类型："+e._s(e.util.ellipsis(i.type,30))+" 文件大小："+e._s(e.util.getFileSize(i.size))+" 创建时间："+e._s(i.createTime)+" ")])]),t("div",{staticClass:"actions"},[t("div",{staticClass:"btn"},[t("Tooltip",{attrs:{content:"下载",placement:"top"}},[t("Icon",{attrs:{type:"md-download",size:"16"},on:{click:function(t){return e.download(i)}}})],1)],1),t("div",{staticClass:"btn"},[t("Tooltip",{attrs:{content:"分享",placement:"top"}},[t("Icon",{attrs:{type:"md-share",size:"16"},on:{click:function(t){return e.share(i)}}})],1)],1),t("div",{staticClass:"btn"},[t("Tooltip",{attrs:{content:"重命名",placement:"top"}},[t("Icon",{attrs:{type:"md-create",size:"16"},on:{click:function(t){return e.rename(i)}}})],1)],1),t("div",{staticClass:"btn-no"},[t("Dropdown",{on:{"on-click":function(t){return e.changeDropDown(i,t)}}},[t("Icon",{attrs:{type:"ios-more",size:"24"}}),t("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t("DropdownItem",{attrs:{name:"collect"}},[e._v(e._s(i.isCollect?"取消收藏":"收藏"))]),t("DropdownItem",{attrs:{name:"copy"}},[e._v("复制")]),t("DropdownItem",{attrs:{name:"remove"}},[e._v("删除")])],1)],1)],1)])])])],1)})),1),t("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[t("Page",{attrs:{current:e.searchForm.pageNumber,total:e.total,"page-size":e.searchForm.pageSize,"page-size-opts":e.pageSizeOpts,size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1)],1)],1),t("Drawer",{attrs:{title:"上传文件至："+e.currCate,closable:"",width:"500"},model:{value:e.uploadVisible,callback:function(t){e.uploadVisible=t},expression:"uploadVisible"}},[t("Upload",{ref:"up",attrs:{action:e.uploadFileUrl,headers:e.accessToken,data:e.uploadData,"on-success":e.handleSuccess,"on-error":e.handleError,"max-size":5120,"on-exceeded-size":e.handleMaxSize,"before-upload":e.beforeUpload,multiple:"",type:"drag"}},[t("div",{staticStyle:{padding:"20px 0"}},[t("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),t("p",[e._v("点击这里或将文件拖拽到这里上传")])],1)]),t("div",{staticClass:"drawer-footer"},[t("Button",{on:{click:e.clearFiles}},[e._v("清空上传列表")])],1)],1),t("Modal",{attrs:{title:e.modalTitle,"mask-closable":!1,width:500},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[t("Form",{ref:"form",attrs:{model:e.form,inline:"",rules:e.formValidate}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"文件名",prop:"title"}},[t("Input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"text"},on:{click:e.handleCancel}},[e._v("取消")]),t("Button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("提交")])],1)],1),t("Modal",{attrs:{title:"移动至","mask-closable":!1,width:500},model:{value:e.moveVisible,callback:function(t){e.moveVisible=t},expression:"moveVisible"}},[t("fileCategory",{staticClass:"fileMoveModal",attrs:{showOnly:""},on:{"on-select":e.selectMoveCategory}}),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"text"},on:{click:function(t){e.moveVisible=!1}}},[e._v("取消")]),t("Button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handleSubmitMove}},[e._v("移动至此")])],1)],1),t("Modal",{attrs:{title:e.videoTitle,width:800,draggable:""},on:{"on-cancel":e.closeVideo},model:{value:e.videoVisible,callback:function(t){e.videoVisible=t},expression:"videoVisible"}},[t("div",{staticStyle:{height:"500px"},attrs:{id:"dplayer"}}),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("span",[e._v("文件类型："+e._s(e.util.ellipsis(e.file.type,30))+" 文件大小："+e._s(e.file.msize)+" 创建时间："+e._s(e.file.createTime))])])])],1)},a=[],o=s("365c"),r=s("e172"),l=s("c91b"),n=s("c06d"),c=s.n(n),h=(s("0808"),s("6a37")),d=s.n(h),p=s("6c6d"),m={name:"file",components:{fileCategory:r["default"],trash:l["default"]},data(){return{showTrash:!1,uploadData:{},currCate:"",expand:!0,span:18,expandIcon:"ios-arrow-back",dp:null,uploadFileUrl:o["Tc"],openSearch:!0,openTip:!0,accessToken:{},loading:!1,fileType:"all",showType:"list",modalVisible:!1,moveVisible:!1,uploadVisible:!1,videoVisible:!1,picVisible:!1,picTitle:"",videoTitle:"",modalTitle:"",moveCategoryId:"",moveFileIds:[],searchForm:{title:"",type:"",pageNumber:1,pageSize:5,sort:"createTime",order:"desc",startDate:"",endDate:"",categoryId:"0",isCollect:null},selectDate:null,options:{shortcuts:p["a"]},form:{title:"",fkey:""},file:{},formValidate:{title:[{required:!0,message:"不能为空",trigger:"blur"}],fkey:[{required:!0,message:"不能为空",trigger:"blur"}]},submitLoading:!1,selectList:[],totalSize:"",columns:[{type:"selection",width:60,align:"center"},{type:"index",width:60,align:"center"},{title:"文件名",key:"title",minWidth:150,sortable:!0,render:(e,t)=>t.row.isCollect?e("div",[e("span",t.row.title),e("Icon",{style:{marginLeft:"5px"},props:{type:"md-star",color:"#ffc60a",size:"18"}})]):e("span",t.row.title)},{title:"缩略图(点击预览)",key:"url",width:150,align:"center",render:(e,t)=>t.row.type.includes("image")>0?e("img",{attrs:{src:t.row.url},style:{cursor:"zoom-in",width:"80px",height:"60px",margin:"10px 0","object-fit":"contain"},on:{click:()=>{this.showPic(t.row)}}}):t.row.type.includes("video")>0?e("video",{style:{cursor:"pointer",width:"80px",height:"60px",margin:"10px 0","object-fit":"contain"},on:{click:()=>{this.showVideo(t.row)}}},[e("source",{attrs:{src:t.row.url+"#t=1",preload:"metadata"}})]):t.row.type.includes("word")>0?e("img",{attrs:{src:s("a19f")},style:{cursor:"zoom-in",width:"80px",height:"60px",margin:"10px 0","object-fit":"contain"},on:{click:()=>{this.showOffice(t.row)}}}):t.row.fkey.includes(".xlsx")>0||t.row.fkey.includes(".xls")>0||t.row.type.includes("sheet")>0?e("img",{attrs:{src:s("4f2c")},style:{cursor:"zoom-in",width:"80px",height:"60px",margin:"10px 0","object-fit":"contain"},on:{click:()=>{this.showOffice(t.row)}}}):t.row.type.includes("presentation")>0?e("img",{attrs:{src:s("f9e9")},style:{cursor:"zoom-in",width:"80px",height:"60px",margin:"10px 0","object-fit":"contain"},on:{click:()=>{this.showOffice(t.row)}}}):t.row.type.includes("pdf")>0?e("img",{attrs:{src:s("2d5e")},style:{cursor:"zoom-in",width:"60px",margin:"10px 0","object-fit":"contain"},on:{click:()=>{this.showFile(t.row)}}}):t.row.type.includes("audio")>0?e("img",{attrs:{src:s("653b")},style:{cursor:"zoom-in",width:"60px",margin:"10px 0","object-fit":"contain"},on:{click:()=>{this.showVideo(t.row)}}}):t.row.type.includes("zip")>0||t.row.type.includes("rar")>0||t.row.type.includes("7z")>0?e("img",{attrs:{src:s("a92c")},style:{width:"60px",margin:"10px 0","object-fit":"contain"},on:{click:()=>{this.$Message.warning("暂不支持预览")}}}):t.row.type.includes("text")>0||t.row.type.includes("octet")>0?e("img",{attrs:{src:s("ab6c")},style:{cursor:"zoom-in",width:"55px",height:"60px",margin:"10px 0","object-fit":"contain"},on:{click:()=>{this.showFile(t.row)}}}):e("img",{attrs:{src:s("ab6c")},style:{width:"55px",height:"60px",margin:"10px 0","object-fit":"contain"},on:{click:()=>{this.$Message.warning("暂不支持预览")}}})},{title:"文件类型",key:"type",width:120,sortable:!0,tooltip:!0},{title:"文件大小",key:"size",width:120,align:"center",sortable:!0,render:(e,t)=>{let s=this.util.getFileSize(t.row.size);return e("span",s)}},{title:"创建时间",key:"createTime",width:180,sortable:!0,sortType:"desc"},{title:"操作",key:"action",align:"center",fixed:"right",width:170,render:(e,t)=>e("div",[e("a",{on:{click:()=>{this.download(t.row)}}},"下载"),e("Divider",{props:{type:"vertical"}}),e("Dropdown",{props:{transfer:!0},on:{"on-click":e=>{this.changeDropDown(t.row,e)}}},[e("a",["更多操作",e("Icon",{props:{type:"ios-arrow-down"}})]),e("DropdownMenu",{slot:"list"},[e("DropdownItem",{props:{name:"share"}},"分享"),e("DropdownItem",{props:{name:"collect"}},t.row.isCollect?"取消收藏":"收藏"),e("DropdownItem",{props:{name:"rename"}},"重命名"),e("DropdownItem",{props:{name:"move"}},"移动"),e("DropdownItem",{props:{name:"copy"}},"复制"),e("DropdownItem",{props:{name:"remove"}},"删除")])])])}],data:[],total:0,pageSizeOpts:[5,10,20]}},methods:{handleDropdown(e){"moveAll"==e?this.moveAll():"removeAll"==e?this.removeAll():"title"==e?(this.searchForm.sort="title",this.getDataList()):"size"==e?(this.searchForm.sort="size",this.getDataList()):"type"==e?(this.searchForm.sort="type",this.getDataList()):"time"==e&&(this.searchForm.sort="createTime",this.getDataList())},init(){this.accessToken={accessToken:this.getStore("accessToken")},Object(o["q"])().then(e=>{e.success||this.$Modal.confirm({title:"系统还未配置OSS",content:"管理员还未配置第三方OSS服务，是否现在立即去配置?",onOk:()=>{this.$router.push({name:"setting",query:{name:"oss"}})}})})},selectCategory(e){"-1"==e.id?(this.searchForm.categoryId="",this.searchForm.isCollect=!0,this.getDataList()):(this.searchForm.isCollect=null,this.searchForm.categoryId=e.id,this.uploadData={categoryId:e.id},this.currCate=e.title,this.getDataList())},changeExpand(){this.expand=!this.expand,this.expand?(this.expandIcon="ios-arrow-back",this.span=18):(this.expandIcon="ios-arrow-forward",this.span=23)},showPic(e){let t=new Image;t.src=e.url;let s=new d.a(t,{hidden:function(){s.destroy()}});s.show()},showVideo(e){this.dp=new c.a({container:document.getElementById("dplayer"),screenshot:!0,video:{url:e.url}}),this.file=e,this.file.msize=this.util.getFileSize(e.size),this.videoTitle=e.title+"("+e.fkey+")",this.videoVisible=!0},closeVideo(){this.dp&&this.dp.destroy()},changePage(e){this.searchForm.pageNumber=e,this.getDataList(),this.clearSelectAll()},changePageSize(e){this.searchForm.pageSize=e,this.getDataList()},changeSort(e){this.searchForm.sort=e.key,this.searchForm.order=e.order,"normal"==e.order&&(this.searchForm.order=""),this.getDataList()},selectDateRange(e){e&&(this.searchForm.startDate=e[0],this.searchForm.endDate=e[1])},changeShowType(){this.searchForm.pageNumber=1,"list"==this.showType?this.searchForm.pageSize=5:this.searchForm.pageSize=12,this.getDataList()},getDataList(){"list"==this.showType?this.pageSizeOpts=[5,10,20]:this.pageSizeOpts=[12,24],this.loading=!0,Object(o["dc"])(this.searchForm).then(e=>{this.loading=!1,e.success&&(this.data=e.result.content,this.total=e.result.totalElements,0==this.data.length&&this.searchForm.pageNumber>1&&(this.searchForm.pageNumber-=1,this.getDataList()))})},handleSearch(){this.searchForm.pageNumber=1,"list"==this.showType?this.searchForm.pageSize=5:this.searchForm.pageSize=12,this.getDataList()},changeFileType(){let e=this.fileType;"all"==e?this.searchForm.type="":"pic"==e?this.searchForm.type="image":"video"==e?this.searchForm.type="video":"word"==e?this.searchForm.type="word":"excel"==e?this.searchForm.type="sheet":"ppt"==e?this.searchForm.type="presentation":"pdf"==e?this.searchForm.type="pdf":"audio"==e?this.searchForm.type="audio":"text"==e?this.searchForm.type="text":"zip"==e?this.searchForm.type="zip":"rar"==e&&(this.searchForm.type="rar"),this.handleSearch()},handleReset(){this.$refs.searchForm.resetFields(),this.searchForm.pageNumber=1,"list"==this.showType?this.searchForm.pageSize=5:this.searchForm.pageSize=12,this.selectDate=null,this.searchForm.startDate="",this.searchForm.endDate="",this.getDataList()},beforeUpload(){return!0},handleMaxSize(e){this.$Notice.warning({title:"文件大小过大",desc:"所选文件‘ "+e.name+" ’大小过大, 不得超过 5M."})},handleSuccess(e,t,s){e.success?(this.$Message.success("上传文件 "+t.name+" 成功"),this.getDataList()):(t.percentage=0,t.status="fail",t.name+="（上传失败）",this.$Message.error(e.message))},handleError(e,t,s){this.$Message.error(e.toString())},clearFiles(){this.$refs.up.clearFiles()},handleCancel(){this.modalVisible=!1},download(e){window.open(e.url+"?attname=&response-content-type=application/octet-stream&filename="+e.title)},showOffice(e){window.open("https://view.officeapps.live.com/op/view.aspx?src="+e.url)},showFile(e){window.open(e.url+"?preview=true")},previewFile(e){e.type.indexOf("audio")>=0?this.showVideo(e):e.type.indexOf("office")>=0||e.type.indexOf("word")>=0?this.showOffice(e):(e.type.indexOf("pdf")>=0||e.type.indexOf("text")>=0||e.type.indexOf("octet")>=0)&&this.showFile(e)},changeDropDown(e,t){"rename"==t?this.rename(e):"copy"==t?this.copy(e):"remove"==t?this.remove(e):"move"==t?this.move(e):"share"==t?this.share(e):"collect"==t&&this.collect(e)},share(e){this.$copyText(e.url).then(e=>{this.$Message.success("复制链接成功")})},selectMoveCategory(e){this.moveCategoryId=e.id},moveAll(){if(this.selectList.length<=0)return void this.$Message.warning("您还未选择要移动的文件");let e="";this.selectList.forEach((function(t){e+=t.id+","})),e=e.substring(0,e.length-1),this.moveFileIds=e,this.moveVisible=!0},move(e){this.moveFileIds=[e.id],this.moveVisible=!0},handleSubmitMove(){this.submitLoading=!0,Object(o["oc"])({ids:this.moveFileIds,categoryId:this.moveCategoryId}).then(e=>{this.submitLoading=!1,e.success&&(this.$Message.success("操作成功"),this.moveVisible=!1,this.clearSelectAll(),this.getDataList())})},copy(e){this.$Modal.confirm({title:"确认复制",content:"您确认要复制文件 "+e.title+" ?",loading:!0,onOk:()=>{Object(o["x"])({id:e.id,key:e.fkey}).then(t=>{this.$Modal.remove(),t.success&&(this.$Message.success("复制文件成功，新文件名为 副本_"+e.title),this.getDataList())})}})},collect(e){Object(o["v"])({id:e.id}).then(t=>{this.$Modal.remove(),t.success&&(this.$Message.success(e.isCollect?"取消收藏成功":"收藏成功"),this.getDataList())})},removeAll(){this.selectList.length<=0?this.$Message.warning("您还未选择要删除的文件"):this.$Modal.confirm({title:"确认删除",content:"您确认要将所选的 "+this.selectList.length+" 个文件移入回收站， 7天内后自动彻底删除",loading:!0,onOk:()=>{let e="";this.selectList.forEach((function(t){e+=t.id+","})),e=e.substring(0,e.length-1),Object(o["Pc"])({ids:e}).then(e=>{this.$Modal.remove(),e.success&&(this.$Message.success("批量删除文件成功"),this.clearSelectAll(),this.getDataList())})}})},remove(e){this.$Modal.confirm({title:"确认删除",content:"您确认要将文件 "+e.title+" 移入回收站， 7天内后自动彻底删除",loading:!0,onOk:()=>{Object(o["Pc"])({ids:e.id}).then(t=>{this.$Modal.remove(),t.success&&(this.clearSelectAll(),this.$Message.success("删除文件 "+e.title+" 成功"),this.getDataList())})}})},handleSubmit(){this.$refs.form.validate(e=>{if(e){this.submitLoading=!0;let e={id:this.form.id,newKey:this.form.fkey,newTitle:this.form.title};Object(o["vc"])(e).then(e=>{this.submitLoading=!1,e.success&&(this.$Message.success("操作成功"),this.getDataList(),this.modalVisible=!1)})}})},rename(e){this.modalTitle="编辑文件名";for(let i in e)null==e[i]&&(e[i]="");let t=JSON.stringify(e),s=JSON.parse(t);this.form=s,this.modalVisible=!0},clearSelectAll(){this.$refs.table.selectAll(!1),this.totalSize=""},changeSelect(e){this.selectList=e;let t=0;e.forEach(e=>{t+=1*e.size}),this.totalSize=this.util.getFileSize(t)}},mounted(){this.init()}},u=m,g=(s("cb6e"),s("2877")),w=Object(g["a"])(u,i,a,!1,null,null,null);t["default"]=w.exports},"6c6d":function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));const i=[{text:"今日",value(){var e=new Date,t=new Date;return e.setTime(t.getTime()),[t,e]}},{text:"昨日",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-864e5),e.setTime(e.getTime()-864e5),[t,e]}},{text:"本周",value(){var e=new Date,t=e.getDay(),s=e.getDate(),i=e.getMonth(),a=t||7,o=new Date(e.getFullYear(),i,s+1-a),r=new Date(e.getFullYear(),i,s+7-a);return o.setTime(o.getTime()),r.setTime(r.getTime()),[o,r]}},{text:"本月",value(){var e=new Date,t=e.getYear();t+=t<2e3?1900:0;var s=e.getMonth(),i=new Date(t,s,1),a=new Date(t,s+1,1),o=(a-i)/864e5,r=new Date(t,s,1),l=new Date(t,s,o);return r.setTime(r.getTime()),l.setTime(l.getTime()),[r,l]}}]},"7f06":function(e,t,s){},cb6e:function(e,t,s){"use strict";s("7f06")},e172:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[e.showOnly?e._e():t("Row",{staticClass:"operation"},[t("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:e.add}},[e._v("添加文件夹")]),t("Dropdown",{on:{"on-click":e.handleTreeDropdown}},[t("Button",[e._v(" 更多操作 "),t("Icon",{attrs:{type:"md-arrow-dropdown"}})],1),t("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t("DropdownItem",{attrs:{name:"edit",disabled:0==e.selectNode.id||-1==e.selectNode.id}},[e._v("编辑文件夹")]),t("DropdownItem",{attrs:{name:"del",disabled:0==e.selectNode.id||-1==e.selectNode.id}},[e._v("删除文件夹")]),t("DropdownItem",{attrs:{name:"refresh"}},[e._v("刷新")])],1)],1)],1),e.showOnly?e._e():t("Alert",{attrs:{"show-icon":""}},[e._v(" 当前选择： "),t("span",{staticClass:"select-title"},[e._v(e._s(e.editTitle))]),e.editTitle&&"0"!=e.selectNode.id?t("a",{staticClass:"select-clear",on:{click:e.cancelEdit}},[e._v("取消选择")]):e._e()]),t("Input",{attrs:{suffix:"ios-search",placeholder:"输入搜索文件夹名称",clearable:""},on:{"on-change":e.search},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}}),t("div",{staticStyle:{position:"relative"}},[t("div",{staticClass:"tree-bar",style:{maxHeight:e.maxHeight}},[t("Tree",{ref:"tree",attrs:{data:e.data,"load-data":e.loadData,render:e.renderContent},on:{"on-check-change":e.changeSelect,"on-select-change":e.selectTree}})],1),e.loading?t("Spin",{attrs:{size:"large",fix:""}}):e._e()],1),t("Modal",{attrs:{title:e.modalTitle,"mask-closable":!1,width:500},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[t("Form",{ref:"form",attrs:{model:e.form,"label-width":85,rules:e.formValidate}},[t("FormItem",{attrs:{label:"上级节点："}},[e._v(e._s(e.form.parentTitle)+" "),t("Tooltip",{staticStyle:{display:"inline-block !important"},attrs:{content:"0"==e.selectNode.id?"若需添加子目录，请先点击选择一个文件夹":"若需添加一级目录，请先取消选择当前文目录",placement:"right",transfer:"","max-width":"290"}},[t("Icon",{staticStyle:{"margin-left":"10px",cursor:"pointer"},attrs:{type:"md-help-circle",size:"20",color:"#c5c5c5"}})],1)],1),t("FormItem",{attrs:{label:"文件夹名",prop:"title"}},[t("Input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("FormItem",{attrs:{label:"排序值",prop:"sortOrder"}},[t("Tooltip",{attrs:{trigger:"hover",placement:"right",content:"值越小越靠前，支持小数"}},[t("InputNumber",{attrs:{max:1e3,min:0},model:{value:e.form.sortOrder,callback:function(t){e.$set(e.form,"sortOrder",t)},expression:"form.sortOrder"}})],1)],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"text"},on:{click:function(t){e.modalVisible=!1}}},[e._v("取消")]),t("Button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handelSubmit}},[e._v("提交")])],1)],1)],1)},a=[],o=s("365c"),r={name:"fileCategory",props:{showOnly:{type:Boolean,default:!1}},data(){return{loading:!1,maxHeight:"500px",searchKey:"",selectNode:{},selectList:[],modalVisible:!1,modalTitle:"",editTitle:"",submitLoading:!1,form:{title:"",sortOrder:0,parentId:0},formValidate:{title:[{required:!0,message:"不能为空",trigger:"blur"}],sortOrder:[{required:!0,type:"number",message:"排序值不能为空",trigger:"change"}]},data:[],editData:{}}},methods:{init(){this.getParentList(),this.editTitle="未归档",this.selectNode={id:"0",title:"未归档"},this.$emit("on-select",this.selectNode)},renderContent(e,{root:t,node:s,data:i}){let a="md-folder-open";return"0"==i.id?a="md-pricetags":"-1"==i.id&&(a="md-star-outline"),e("span",[e("span",[e("Icon",{props:{type:a,size:16},style:{"margin-right":"8px"}}),e("span",i.title)])])},getParentList(){this.loading=!0;let e={parentId:0,delFlag:0};Object(o["Db"])(e).then(e=>{this.loading=!1,e.success&&(e.result.forEach((function(e){e.isParent&&(e.loading=!1,e.children=[],e._loading=!1)})),this.data=e.result,this.data.unshift({id:"0",title:"未归档",selected:!0},{id:"-1",title:"收藏夹",selected:!1}))})},loadData(e,t){let s={parentId:e.id,delFlag:0};Object(o["Db"])(s).then(e=>{e.success&&(e.result.forEach((function(e){e.isParent&&(e.loading=!1,e.children=[],e._loading=!1)})),t(e.result))})},search(){this.searchKey?(this.loading=!0,Object(o["Dc"])({title:this.searchKey}).then(e=>{this.loading=!1,e.success&&(this.data=e.result)})):this.getParentList()},selectTree(e){if(e.length>0){this.$refs.form.resetFields();for(let i in e[0])null==e[0][i]&&(e[0][i]="");let t=JSON.stringify(e[0]),s=JSON.parse(t);this.selectNode=s,this.form=s,this.editData=s,this.editTitle=s.title,this.$emit("on-select",this.selectNode)}else this.cancelEdit()},cancelEdit(){if("0"==this.selectNode.id)return void(this.data[0].selected=!0);let e=this.$refs.tree.getSelectedNodes()[0];e&&(e.selected=!1),this.$refs.form.resetFields(),this.editData={},this.selectNode={id:"0",title:"未归档"},this.editTitle="未归档",this.data[0].selected=!0,this.$emit("on-select",this.selectNode)},changeSelect(e){this.selectList=e},handleTreeDropdown(e){"edit"==e?this.edit():"del"==e?this.del():"refresh"==e&&this.init()},add(){this.modalType=0,"0"==this.selectNode.id||"-1"==this.selectNode.id?(this.modalTitle="添加一级文件夹",this.form={parentId:"0",parentTitle:"一级目录",sortOrder:this.data.length+1}):(this.modalTitle="添加子文件夹",this.form.children||(this.form.children=[]),this.form={parentId:this.selectNode.id,parentTitle:this.selectNode.title,sortOrder:this.form.children.length+1}),this.modalVisible=!0},edit(){"0"!=this.selectNode.id&&"-1"!=this.selectNode.id?(this.editData&&(this.form=this.editData),this.modalType=1,this.modalTitle="编辑文件夹",this.modalVisible=!0):this.$Message.warning("您还未选择要编辑的文件夹")},handelSubmit(){this.$refs.form.validate(e=>{e&&(this.submitLoading=!0,0==this.modalType?(delete this.form.id,Object(o["d"])(this.form).then(e=>{this.submitLoading=!1,e.success&&(this.$Message.success("操作成功"),this.getParentList(),this.modalVisible=!1)})):1==this.modalType&&Object(o["ab"])(this.form).then(e=>{this.submitLoading=!1,e.success&&(this.editTitle=this.form.title,this.$Message.success("操作成功"),this.getParentList(),this.modalVisible=!1)}))})},del(){"0"!=this.selectNode.id&&"-1"!=this.selectNode.id?this.$Modal.confirm({title:"确认删除",loading:!0,content:"您确认要将文件夹 "+this.selectNode.title+" 及其所有文件移入回收站， 7天内后自动彻底删除",onOk:()=>{Object(o["Qc"])({id:this.selectNode.id}).then(e=>{this.$Modal.remove(),e.success&&(this.$Message.success("操作成功"),this.init())})}}):this.$Message.warning("您还未选择要删除的文件夹")}},mounted(){let e=document.documentElement.clientHeight;this.maxHeight=Number(e-287)+"px",this.init()}},l=r,n=s("2877"),c=Object(n["a"])(l,i,a,!1,null,null,null);t["default"]=c.exports}}]);