(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3183e6d3"],{2798:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"search"},[t("Card",[t("Row",{staticClass:"operation",attrs:{align:"middle",justify:"space-between"}},[t("div",[t("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:e.addRole}},[e._v("添加角色")]),t("Button",{attrs:{icon:"md-trash"},on:{click:e.delAll}},[e._v("批量删除")]),t("Input",{staticStyle:{width:"250px"},attrs:{suffix:"ios-search",placeholder:"输入关键词搜索",clearable:""},on:{"on-change":e.getDataList},model:{value:e.searchForm.key,callback:function(t){e.$set(e.searchForm,"key",t)},expression:"searchForm.key"}})],1),t("div",{staticClass:"icons"},[t("Tooltip",{attrs:{content:"刷新",placement:"top",transfer:""}},[t("Icon",{staticClass:"item",attrs:{type:"md-refresh",size:"18"},on:{click:e.init}})],1),t("Tooltip",{attrs:{content:e.openTip?"关闭提示":"开启提示",placement:"top",transfer:""}},[t("Icon",{staticClass:"item tip",attrs:{type:"md-bulb",size:"18"},on:{click:function(t){e.openTip=!e.openTip}}})],1),t("Tooltip",{attrs:{content:"表格密度",placement:"top",transfer:""}},[t("Dropdown",{attrs:{trigger:"click"},on:{"on-click":e.changeTableSize}},[t("Icon",{staticClass:"item",attrs:{type:"md-list",size:"18"}}),t("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t("DropdownItem",{attrs:{selected:"default"==e.tableSize,name:"default"}},[e._v("默认")]),t("DropdownItem",{attrs:{selected:"large"==e.tableSize,name:"large"}},[e._v("宽松")]),t("DropdownItem",{attrs:{selected:"small"==e.tableSize,name:"small"}},[e._v("紧密")])],1)],1)],1),t("Tooltip",{attrs:{content:"导出数据",placement:"top",transfer:""}},[t("Icon",{staticClass:"item",attrs:{type:"md-download",size:"18"},on:{click:e.exportData}})],1)],1)]),t("Alert",{directives:[{name:"show",rawName:"v-show",value:e.openTip,expression:"openTip"}],attrs:{"show-icon":""}},[e._v(" 已选择 "),t("span",{staticClass:"select-count"},[e._v(e._s(e.selectList.length))]),e._v(" 项 "),t("a",{staticClass:"select-clear",on:{click:e.clearSelectAll}},[e._v("清空")])]),t("Table",{ref:"table",attrs:{loading:e.loading,border:"",columns:e.columns,data:e.data,size:e.tableSize,sortable:"custom"},on:{"on-sort-change":e.changeSort,"on-selection-change":e.changeSelect}}),t("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[t("Page",{attrs:{current:e.searchForm.pageNumber,total:e.total,"page-size":e.searchForm.pageSize,"page-size-opts":[10,20,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1),t("Modal",{attrs:{title:e.modalTitle,"mask-closable":!1,width:500},model:{value:e.roleModalVisible,callback:function(t){e.roleModalVisible=t},expression:"roleModalVisible"}},[t("Form",{ref:"roleForm",attrs:{model:e.roleForm,"label-width":80,rules:e.roleFormValidate}},[t("FormItem",{attrs:{label:"角色名称",prop:"name"}},[t("Input",{attrs:{placeholder:"按照Spring Security约定建议以‘ROLE_’开头"},model:{value:e.roleForm.name,callback:function(t){e.$set(e.roleForm,"name",t)},expression:"roleForm.name"}})],1),t("FormItem",{attrs:{label:"备注",prop:"description"}},[t("Input",{model:{value:e.roleForm.description,callback:function(t){e.$set(e.roleForm,"description",t)},expression:"roleForm.description"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"text"},on:{click:e.cancelRole}},[e._v("取消")]),t("Button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.submitRole}},[e._v("提交")])],1)],1),t("Drawer",{attrs:{title:e.modalTitle,"mask-closable":!1,width:500,draggable:""},model:{value:e.permModalVisible,callback:function(t){e.permModalVisible=t},expression:"permModalVisible"}},[t("div",{staticClass:"drawer-content",style:{maxHeight:e.maxHeight}},[t("div",{staticStyle:{position:"relative"}},[t("Tree",{ref:"tree",attrs:{data:e.permData,"show-checkbox":"",render:e.renderContent,"check-strictly":!0}}),e.treeLoading?t("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)]),t("div",{staticClass:"drawer-footer br"},[t("Button",{attrs:{type:"primary",loading:e.submitPermLoading},on:{click:e.submitPermEdit}},[e._v("提交")]),t("Button",{on:{click:e.selectTreeAll}},[e._v("全选/反选")]),t("Select",{staticStyle:{width:"110px"},attrs:{transfer:""},on:{"on-change":e.changeOpen},model:{value:e.openLevel,callback:function(t){e.openLevel=t},expression:"openLevel"}},[t("Option",{attrs:{value:"0"}},[e._v("展开所有")]),t("Option",{attrs:{value:"1"}},[e._v("收合所有")]),t("Option",{attrs:{value:"2"}},[e._v("仅展开一级")]),t("Option",{attrs:{value:"3"}},[e._v("仅展开两级")])],1),t("Button",{attrs:{type:"text"},on:{click:e.cancelPermEdit}},[e._v("取消")])],1)]),t("Modal",{attrs:{title:e.modalTitle,"mask-closable":!1,width:500},model:{value:e.depModalVisible,callback:function(t){e.depModalVisible=t},expression:"depModalVisible"}},[t("div",{staticClass:"depModal"},[t("Alert",{attrs:{"show-icon":""}},[e._v("默认可查看全部数据，自定义数据范围时请勾选下方数据")]),t("Form",{attrs:{"label-width":85}},[t("FormItem",{attrs:{label:"数据范围"}},[t("Select",{attrs:{transfer:""},model:{value:e.dataType,callback:function(t){e.dataType=t},expression:"dataType"}},[t("Option",{attrs:{value:0}},[e._v("全部数据权限")]),t("Option",{attrs:{value:1}},[e._v("自定义数据权限")]),t("Option",{attrs:{value:2}},[e._v("本部门及以下数据权限")]),t("Option",{attrs:{value:3}},[e._v("本部门数据权限")]),t("Option",{attrs:{value:4}},[e._v("仅自己数据权限")])],1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:1==e.dataType,expression:"dataType == 1"}],staticStyle:{"margin-top":"15px"}},[t("div",{staticStyle:{position:"relative"}},[t("Tree",{ref:"depTree",staticStyle:{"margin-top":"15px"},attrs:{data:e.depData,"load-data":e.loadData,multiple:""},on:{"on-toggle-expand":e.expandCheckDep}}),e.depTreeLoading?t("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)])],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"text"},on:{click:function(t){e.depModalVisible=!1}}},[e._v("取消")]),t("Button",{attrs:{type:"primary",loading:e.submitDepLoading},on:{click:e.submitDepEdit}},[e._v("提交")])],1)])],1)},a=[],l=i("365c"),r=i("c276"),o={name:"role-manage",data(){return{tableSize:"default",maxHeight:510,openTip:!0,openLevel:"0",loading:!0,treeLoading:!0,depTreeLoading:!0,submitPermLoading:!1,submitDepLoading:!1,searchKey:"",sortColumn:"createTime",sortType:"desc",modalType:0,roleModalVisible:!1,permModalVisible:!1,depModalVisible:!1,modalTitle:"",searchForm:{pageNumber:1,pageSize:10,sort:"createTime",order:"desc",key:""},roleForm:{name:"",description:""},roleFormValidate:{name:[{required:!0,message:"角色名称不能为空",trigger:"blur"}]},submitLoading:!1,selectList:[],columns:[{type:"selection",width:60,align:"center"},{type:"index",width:60,align:"center"},{title:"角色名称",key:"name",minWidth:150,sortable:!0},{title:"备注",key:"description",minWidth:150,sortable:!0},{title:"创建时间",key:"createTime",width:170,sortable:!0,sortType:"desc"},{title:"更新时间",key:"updateTime",width:170,sortable:!0},{title:"设置为注册用户默认角色",key:"defaultRole",align:"center",width:200,render:(e,t)=>t.row.defaultRole?e("div",[e("Checkbox",{props:{value:!0},on:{"on-change":()=>{this.cancelDefault(t.row)}}})]):e("div",[e("Checkbox",{props:{value:!1},on:{"on-change":()=>{this.setDefault(t.row)}}})])},{title:"操作",key:"action",align:"center",fixed:"right",width:270,render:(e,t)=>e("div",[e("a",{on:{click:()=>{this.editPerm(t.row)}}},"菜单权限"),e("Divider",{props:{type:"vertical"}}),e("a",{on:{click:()=>{this.editDep(t.row)}}},"数据权限"),e("Divider",{props:{type:"vertical"}}),e("a",{on:{click:()=>{this.edit(t.row)}}},"编辑"),e("Divider",{props:{type:"vertical"}}),e("a",{on:{click:()=>{this.remove(t.row)}}},"删除")])}],data:[],total:0,permData:[],editRolePermId:"",selectAllFlag:!1,depData:[],dataType:0,editDepartments:[]}},methods:{init(){this.getDataList(),this.getPermList()},renderContent(e,{root:t,node:i,data:s}){let a="";return a=0==s.level?"ios-navigate":1==s.level?"md-list-box":2==s.level?"md-list":3==s.level?"md-radio-button-on":"md-radio-button-off",e("span",{style:{display:"inline-block",cursor:"pointer"},on:{click:()=>{-1!=s.status&&(s.checked=!s.checked)}}},[e("span",[e("Icon",{props:{type:a,size:"16"},style:{"margin-right":"8px","margin-bottom":"3px"}}),e("span",s.title)])])},changePage(e){this.searchForm.pageNumber=e,this.getDataList(),this.clearSelectAll()},changePageSize(e){this.searchForm.pageSize=e,this.getDataList()},changeSort(e){this.searchForm.sort=e.key,this.searchForm.order=e.order,"normal"==e.order&&(this.searchForm.order=""),this.getDataList()},changeTableSize(e){this.tableSize=e},exportData(){this.$refs.table.exportCsv({filename:"数据"})},getDataList(){this.loading=!0,Object(l["Zb"])(this.searchForm).then(e=>{this.loading=!1,e.success&&(this.data=e.result.content,this.total=e.result.totalElements,0==this.data.length&&this.searchForm.pageNumber>1&&(this.searchForm.pageNumber-=1,this.getDataList()))})},getPermList(){this.treeLoading=!0,Object(l["wb"])().then(e=>{e.success&&(this.deleteDisableNode(e.result),this.permData=e.result,this.treeLoading=!1),this.treeLoading=!1})},deleteDisableNode(e){let t=this;e.forEach((function(e){-1==e.status&&(e.title="[已禁用] "+e.title,e.disabled=!0),e.children&&e.children.length>0&&t.deleteDisableNode(e.children)}))},cancelRole(){this.roleModalVisible=!1},submitRole(){this.$refs.roleForm.validate(e=>{e&&(0==this.modalType?(this.submitLoading=!0,Object(l["j"])(this.roleForm).then(e=>{this.submitLoading=!1,e.success&&(this.$Message.success("操作成功"),this.getDataList(),this.roleModalVisible=!1)})):(this.submitLoading=!0,Object(l["kb"])(this.roleForm).then(e=>{this.submitLoading=!1,e.success&&(this.$Message.success("操作成功"),this.getDataList(),this.roleModalVisible=!1)})))})},addRole(){this.modalType=0,this.modalTitle="添加角色",this.$refs.roleForm.resetFields(),delete this.roleForm.id,this.roleModalVisible=!0},edit(e){this.modalType=1,this.modalTitle="编辑角色",this.$refs.roleForm.resetFields();for(let s in e)null==e[s]&&(e[s]="");let t=JSON.stringify(e),i=JSON.parse(t);this.roleForm=i,this.roleModalVisible=!0},remove(e){this.$Modal.confirm({title:"确认删除",content:"您确认要删除角色 "+e.name+" ?",loading:!0,onOk:()=>{Object(l["N"])({ids:e.id}).then(e=>{this.$Modal.remove(),e.success&&(this.clearSelectAll(),this.$Message.success("删除成功"),this.getDataList())})}})},setDefault(e){this.loading=!0;let t={id:e.id,isDefault:!0};Object(l["Nc"])(t).then(e=>{this.loading=!1,e.success&&(this.$Message.success("操作成功"),this.getDataList())})},cancelDefault(e){this.loading=!0;let t={id:e.id,isDefault:!1};Object(l["Nc"])(t).then(e=>{this.loading=!1,e.success&&(this.$Message.success("操作成功"),this.getDataList())})},clearSelectAll(){this.$refs.table.selectAll(!1)},changeSelect(e){this.selectList=e},delAll(){this.selectList.length<=0?this.$Message.warning("您还未选择要删除的数据"):this.$Modal.confirm({title:"确认删除",content:"您确认要删除所选的 "+this.selectList.length+" 条数据?",loading:!0,onOk:()=>{let e="";this.selectList.forEach((function(t){e+=t.id+","})),e=e.substring(0,e.length-1),Object(l["N"])({ids:e}).then(e=>{this.$Modal.remove(),e.success&&(this.$Message.success("删除成功"),this.clearSelectAll(),this.getDataList())})}})},editPerm(e){this.editRolePermId=e.id,this.modalTitle="分配 "+e.name+" 的菜单权限";let t=e.permissions;this.treeLoading?this.$Message.warning("菜单权限数据加载中，请稍后点击查看"):(this.checkPermTree(this.permData,t),this.permModalVisible=!0)},checkPermTree(e,t){let i=this;e.forEach((function(e){i.hasPerm(e,t)&&-1!=e.status?e.checked=!0:e.checked=!1,e.children&&e.children.length>0&&i.checkPermTree(e.children,t)}))},hasPerm(e,t){let i=!1;for(let s=0;s<t.length;s++)if(e.id==t[s].permissionId){i=!0;break}return!!i},selectTreeAll(){this.selectAllFlag=!this.selectAllFlag;let e=this.selectAllFlag;this.selectedTreeAll(this.permData,e)},selectedTreeAll(e,t){let i=this;e.forEach((function(e){e.checked=t,e.children&&e.children.length>0&&i.selectedTreeAll(e.children,t)}))},submitPermEdit(){this.submitPermLoading=!0;let e="",t=this.$refs.tree.getCheckedNodes();t.forEach((function(t){e+=t.id+","})),e=e.substring(0,e.length-1),Object(l["mb"])({roleId:this.editRolePermId,permIds:e}).then(e=>{this.submitPermLoading=!1,e.success&&(this.$Message.success("操作成功"),this.$store.commit("setAdded",!1),r["a"].initRouter(this),this.getDataList(),this.permModalVisible=!1)})},cancelPermEdit(){this.permModalVisible=!1},loadData(e,t){Object(l["lc"])(e.id,{openDataFilter:!1}).then(e=>{e.success&&(e.result.forEach((function(e){e.selected=!1,e.isParent&&(e.loading=!1,e.children=[]),-1==e.status&&(e.title="[已禁用] "+e.title,e.disabled=!0)})),t(e.result))})},editDep(e){this.dataType=0,this.editRolePermId=e.id,this.modalTitle="分配 "+e.name+" 的数据权限",e.dataType&&(this.dataType=e.dataType);let t=e.departments;this.editDepartments=t,this.depTreeLoading=!0,Object(l["jc"])({openDataFilter:!1}).then(e=>{this.depTreeLoading=!1,e.success&&(e.result.forEach((function(e){e.selected=!1,e.isParent&&(e.loading=!1,e.children=[]),-1==e.status&&(e.title="[已禁用] "+e.title,e.disabled=!0)})),this.depData=e.result,this.checkDepTree(this.depData,t))}),this.depModalVisible=!0},expandCheckDep(e){this.checkDepTree(e.children,this.editDepartments)},checkDepTree(e,t){let i=this;e.forEach((function(e){i.hasDepPerm(e,t)?e.selected=!0:e.selected=!1}))},hasDepPerm(e,t){let i=!1;for(let s=0;s<t.length;s++)if(e.id==t[s].departmentId){i=!0;break}return!!i},submitDepEdit(){let e="";if(1==this.dataType){let t=this.$refs.depTree.getSelectedNodes();t.forEach((function(t){e+=t.id+","})),e=e.substring(0,e.length-1)}this.submitDepLoading=!0,Object(l["lb"])({roleId:this.editRolePermId,dataType:this.dataType,depIds:e}).then(e=>{this.submitDepLoading=!1,e.success&&(this.$Message.success("操作成功"),this.getDataList(),this.depModalVisible=!1)})},changeOpen(e){"0"==e?this.permData.forEach(e=>{e.expand=!0,e.children&&e.children.length>0&&e.children.forEach(e=>{e.expand=!0,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!0}))})}):"1"==e?this.permData.forEach(e=>{e.expand=!1,e.children&&e.children.length>0&&e.children.forEach(e=>{e.expand=!1,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!1}))})}):"2"==e?this.permData.forEach(e=>{e.expand=!0,e.children&&e.children.length>0&&e.children.forEach(e=>{e.expand=!1,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!1}))})}):"3"==e&&this.permData.forEach(e=>{e.expand=!0,e.children&&e.children.length>0&&e.children.forEach(e=>{e.expand=!0,e.children&&e.children.length>0&&e.children.forEach((function(e){e.expand=!1}))})})}},mounted(){this.maxHeight=Number(document.documentElement.clientHeight-121)+"px",this.init()}},n=o,c=(i("dbc0"),i("2877")),d=Object(c["a"])(n,s,a,!1,null,null,null);t["default"]=d.exports},3172:function(e,t,i){},dbc0:function(e,t,i){"use strict";i("3172")}}]);