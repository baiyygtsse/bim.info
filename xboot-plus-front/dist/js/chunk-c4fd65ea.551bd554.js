(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c4fd65ea"],{1755:function(e,t,s){},"821a":function(e,t,s){"use strict";s("1755")},f0c3:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"own-space-message-content",style:{height:e.height}},[t("div",{staticClass:"message-main-content"},[t("div",{staticClass:"message-mainlist-content"},[t("div",[t("Button",{attrs:{size:"large",long:"",type:"text"},on:{click:function(t){return e.setCurrentMesType("unread")}}},[t("div",{staticClass:"mes-wrap"},[t("transition",{attrs:{name:"mes-current-type-btn"}},[t("Icon",{directives:[{name:"show",rawName:"v-show",value:"unread"==e.currentMesType,expression:"currentMesType == 'unread'"}],attrs:{type:"md-checkmark"}})],1),t("span",{staticClass:"mes-type-btn-text"},[e._v("未读消息")]),t("Badge",{staticClass:"message-count-badge-outer",attrs:{"class-name":"message-count-badge-red",count:e.unreadCount}})],1)])],1),t("div",[t("Button",{attrs:{size:"large",long:"",type:"text"},on:{click:function(t){return e.setCurrentMesType("hasread")}}},[t("div",{staticClass:"mes-wrap"},[t("transition",{attrs:{name:"mes-current-type-btn"}},[t("Icon",{directives:[{name:"show",rawName:"v-show",value:"hasread"==e.currentMesType,expression:"currentMesType == 'hasread'"}],attrs:{type:"md-checkmark"}})],1),t("span",{staticClass:"mes-type-btn-text"},[e._v("已读消息")]),t("Badge",{staticClass:"message-count-badge-outer",attrs:{"class-name":"message-count-badge",count:e.hasreadCount}})],1)])],1)]),t("div",{staticClass:"message-content-content"},[t("transition",{attrs:{name:"view-message"}},[e.showMesList?t("div",{staticClass:"message-title-list-content"},[t("Table",{ref:"messageList",attrs:{loading:e.loading,columns:e.columns,data:e.mesList}}),t("div",{staticClass:"message-page"},["unread"==e.currentMesType?t("Poptip",{attrs:{confirm:"",transfer:"",title:"确定标记所有消息为已读？"},on:{"on-ok":e.readAll}},[t("Button",{attrs:{icon:"md-notifications-off",disabled:e.unreadCount<=0}},[e._v("全部标记已读")])],1):e._e(),"hasread"==e.currentMesType?t("Poptip",{attrs:{confirm:"",transfer:"",title:"确定彻底删除所有已读消息？"},on:{"on-ok":e.deleteAll}},[t("Button",{attrs:{icon:"md-trash",disabled:e.hasreadCount<=0}},[e._v("全部彻底删除")])],1):e._e(),t("Page",{staticClass:"page-fix",attrs:{current:e.params.pageNumber,total:e.total,"page-size":e.params.pageSize,"page-size-opts":[5,10],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1):e._e()]),t("transition",{attrs:{name:"back-message-list"}},[e.showMesList?e._e():t("div",{staticClass:"message-view-content-content"},[t("div",{staticClass:"message-content-top-bar"},[t("span",{staticClass:"mes-back-btn-content"},[t("Button",{attrs:{type:"text"},on:{click:e.backList}},[t("Icon",{attrs:{type:"ios-arrow-back"}}),e._v("  返回 ")],1)],1),t("h3",{staticClass:"mes-title"},[e._v(e._s(e.mes.title))])]),t("p",{staticClass:"mes-time-content"},[t("Icon",{attrs:{type:"android-time"}}),e._v("   "+e._s(e.mes.time)+" ")],1),t("div",{staticClass:"message-content-body"},[t("p",{staticClass:"message-content",domProps:{innerHTML:e._s(e.mes.content)}},[e._v(" "+e._s(e.mes.content)+" ")])])])])],1)])])},n=[],i=s("852e"),r=s.n(i),o=s("365c"),c={name:"message_index",data(){const e=(e,t)=>e("Button",{props:{icon:"md-eye-off",size:"small"},on:{click:()=>{let e=t.row;for(let t in e)null==e[t]&&(e[t]="");let s=JSON.stringify(e),a=JSON.parse(s);a.status=1,this.loading=!0,Object(o["cb"])(a).then(e=>{this.loading=!1,e.success&&(this.$Message.success("操作成功"),this.getCount(),this.refreshMessage())})}}},"标为已读"),t=(e,t)=>e("Button",{props:{icon:"md-trash",size:"small"},on:{click:()=>{let e=t.row;this.loading=!0,Object(o["H"])({ids:e.id}).then(e=>{this.loading=!1,e.success&&(this.$Message.success("操作成功"),this.getCount(),this.refreshMessage())})}}},"删除");return{height:"500px",loading:!0,params:{userId:JSON.parse(r.a.get("userInfo")).id,status:0,pageNumber:1,pageSize:10,sort:"createTime",order:"desc"},total:0,mesList:[],currentMesType:"unread",showMesList:!0,unreadCount:0,hasreadCount:0,mes:{title:"",time:"",content:""},columns:[{type:"index",width:60,align:"center"},{title:" ",key:"title",align:"left",ellipsis:!0,render:(e,t)=>e("span",[e("a",{style:{margin:"0 30px 0 0"},on:{click:()=>{this.getContent(t.row)}}},"【"+t.row.type+"】 "+t.row.title)])},{title:" ",key:"time",align:"center",width:190,render:(e,t)=>e("span",[e("Icon",{props:{type:"md-time",size:16},style:{margin:"0 5px 3px 0"}}),e("span",t.row.createTime)])},{title:" ",key:"asread",align:"center",width:210,render:(s,a)=>"unread"==this.currentMesType?s("div",[e(s,a)]):"hasread"==this.currentMesType?s("div",[t(s,a)]):void 0}]}},methods:{changePage(e){this.params.pageNumber=e,this.refreshMessage()},changePageSize(e){this.params.pageSize=e,this.refreshMessage()},refreshMessage(){let e=0,t=this.currentMesType;"unread"==t?e=0:"hasread"==t&&(e=1),this.params.status=e,this.loading=!0,Object(o["Lb"])(this.params).then(e=>{this.loading=!1,e.success&&(this.mesList=e.result.content,this.total=e.result.totalElements,"unread"==t?this.unreadCount=this.total:"hasread"==t&&(this.hasreadCount=this.total))})},initMessage(){let e=this.$route.query;e.content&&this.getContent(e.content),this.getCount(!0)},getCount(e){this.getUnreadCount(e),this.getReadCount()},getUnreadCount(e){this.params.status=0,Object(o["Lb"])(this.params).then(t=>{t.success&&(e&&(this.loading=!1,this.mesList=t.result.content),this.unreadCount=t.result.totalElements,this.$store.commit("setMessageCount",this.unreadCount))})},getReadCount(){this.params.status=1,Object(o["Lb"])(this.params).then(e=>{e.success&&(this.hasreadCount=e.result.totalElements)})},deleteMessage(e){Object(o["H"])({ids:e}).then(e=>{e.success&&this.$Message.success("删除成功")})},setCurrentMesType(e){this.currentMesType!=e&&(this.showMesList=!0),this.currentMesType=e,this.params.pageNumber=1,this.refreshMessage()},getContent(e){if(this.showMesList=!1,this.mes.title=e.title,this.mes.time=e.createTime,this.mes.content=e.content,0==e.status){for(let a in e)null==e[a]&&(e[a]="");let t=JSON.stringify(e),s=JSON.parse(t);s.status=1,Object(o["cb"])(s).then(e=>{e.success&&(this.getCount(),this.refreshMessage())})}},readAll(){Object(o["m"])(0).then(e=>{e.success&&(this.getCount(),this.refreshMessage())})},deleteAll(){Object(o["m"])(1).then(e=>{e.success&&(this.getCount(),this.refreshMessage())})},backList(){this.showMesList=!0,this.$router.push({name:"message_index"})}},mounted(){let e=document.documentElement.clientHeight;this.height=Number(e-120)+"px",this.initMessage()},watch:{$route(e,t){if("message_index"==e.name){let e=this.$route.query;if(e.content)return void this.initMessage();this.refreshMessage()}}}},h=c,u=(s("821a"),s("2877")),l=Object(u["a"])(h,a,n,!1,null,null,null);t["default"]=l.exports}}]);